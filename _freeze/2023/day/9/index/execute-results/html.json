{
  "hash": "bacafeca77156161d1670150c4dac52c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"2023: Day 9\"\ndate: 2023-12-9\ncategories:\n  - R\n  - sequences\n  - map\ndraft: false\n---\n\n\n## Setup and notes\n\n[The original challenge](https://adventofcode.com/2023/day/9)\n\n[My data](input){target=\"_blank\"}\n\nPuzzle input: series of values about the oasis ecosystem. Each line corresponds to the history of a single value.\n\nFor example:\n\n```\n0 3 6 9 12 15\n1 3 6 10 15 21\n10 13 16 21 30 45\n```\nMust create environmental report with prediction of the next value in each series.\n\n\n> To do this, start by making a new sequence from the difference at each step of your history. If that sequence is not all zeroes, repeat this process, using the sequence you just generated as the input sequence. Once all of the values in your latest sequence are zeroes, you can extrapolate what the next value of the original history should be.\n\nExample:\n```\n0   3   6   9  12  15\n  3   3   3   3   3\n    0   0   0   0\n```\n\n> To extrapolate, start by adding a new zero to the end of your list of zeroes; because the zeroes represent differences between the two values above them, this also means there is now a placeholder in every sequence above it:\n\n```\n0   3   6   9  12  15   B\n  3   3   3   3   3   A\n    0   0   0   0   0\n```\n\nIn this example, the next value in sequence (`B`) is *18*.\n\nNote that for each series it may be necessary to obtain a different number of sequences until reaching the all-zero differences.\n\n```\n1   3   6  10  15  21\n  2   3   4   5   6\n    1   1   1   1\n      0   0   0\n```\n\n> Analyze your OASIS report and extrapolate the next value for each history. What is the sum of these extrapolated values?\n\n## Part 1\n\nI think it's a good idea to load this data as a list of vectors (each row in the input would be a vector).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ninput <- here(\"2023/day/9/input\")  %>%\n  read_lines() %>%\n  str_split(\" \") %>%\n  map(as.numeric) %>%\n  map(list)\n\ninput[1:5]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n [1]      3     10     23     46     99    234    563   1310   2904   6131\n[11]  12351  23745  43470  75464 123501 189097 268370 349700 418439 484617\n[21] 669380\n\n\n[[2]]\n[[2]][[1]]\n [1]     16     41     77    119    171    265    488   1017   2162   4417\n[11]   8519  15515  26837  44385  70618 108653 162372 236537 336913 470399\n[21] 645167\n\n\n[[3]]\n[[3]][[1]]\n [1]      20      45      91     182     351     648    1157    2027    3543\n[10]    6296   11556   22009   43088   85209  167316  322244  604526 1101399\n[19] 1947905 3347136 5596837\n\n\n[[4]]\n[[4]][[1]]\n [1]      24      50      87     141     223     341     487     621     653\n[10]     420    -352   -2121   -5670  -12365  -24598  -46505  -85074 -151786\n[19] -264963 -453031 -758943\n\n\n[[5]]\n[[5]][[1]]\n [1]       13       31       76      172      351      645     1075     1649\n [9]     2399     3508     5604    10347    21558    47460   105396   232221\n[17]   507493  1104469  2398816  5191706 11149877\n```\n\n\n:::\n:::\n\n\nNow, for each item of the list, I should iteratively add `diff`s until all of the elements of the last diff are zero.\n\nLet's do it for a base case:\n\n::: {.cell}\n\n```{.r .cell-code}\nexample_case <- input[[1]]\n\nlast_vector <- example_case[[1]]\n\noutput <- example_case\n\nwhile (any(last_vector) != 0) {\n  last_vector <- diff(last_vector)\n  output <- append(output, list(last_vector))\n}\n\noutput\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n [1]      3     10     23     46     99    234    563   1310   2904   6131\n[11]  12351  23745  43470  75464 123501 189097 268370 349700 418439 484617\n[21] 669380\n\n[[2]]\n [1]      7     13     23     53    135    329    747   1594   3227   6220\n[11]  11394  19725  31994  48037  65596  79273  81330  68739  66178 184763\n\n[[3]]\n [1]      6     10     30     82    194    418    847   1633   2993   5174\n[11]   8331  12269  16043  17559  13677   2057 -12591  -2561 118585\n\n[[4]]\n [1]      4     20     52    112    224    429    786   1360   2181   3157\n[11]   3938   3774   1516  -3882 -11620 -14648  10030 121146\n\n[[5]]\n [1]     16     32     60    112    205    357    574    821    976    781\n[11]   -164  -2258  -5398  -7738  -3028  24678 111116\n\n[[6]]\n [1]    16    28    52    93   152   217   247   155  -195  -945 -2094 -3140\n[13] -2340  4710 27706 86438\n\n[[7]]\n [1]    12    24    41    59    65    30   -92  -350  -750 -1149 -1046   800\n[13]  7050 22996 58732\n\n[[8]]\n [1]    12    17    18     6   -35  -122  -258  -400  -399   103  1846  6250\n[13] 15946 35736\n\n[[9]]\n [1]     5     1   -12   -41   -87  -136  -142     1   502  1743  4404  9696\n[13] 19790\n\n[[10]]\n [1]    -4   -13   -29   -46   -49    -6   143   501  1241  2661  5292 10094\n\n[[11]]\n [1]   -9  -16  -17   -3   43  149  358  740 1420 2631 4802\n\n[[12]]\n [1]   -7   -1   14   46  106  209  382  680 1211 2171\n\n[[13]]\n[1]   6  15  32  60 103 173 298 531 960\n\n[[14]]\n[1]   9  17  28  43  70 125 233 429\n\n[[15]]\n[1]   8  11  15  27  55 108 196\n\n[[16]]\n[1]  3  4 12 28 53 88\n\n[[17]]\n[1]  1  8 16 25 35\n\n[[18]]\n[1]  7  8  9 10\n\n[[19]]\n[1] 1 1 1\n\n[[20]]\n[1] 0 0\n```\n\n\n:::\n:::\n\n\nNow let's turn this into a function and apply it to the original list through `purrr:map`\n\n::: {.cell}\n\n```{.r .cell-code}\nobtain_diffs <- function(history) {\n  last_vector <- history[[1]]\n\n  output <- history\n\n  while (any(last_vector != 0)) {\n    last_vector <- diff(last_vector)\n    output <- append(output, list(last_vector))\n  }\n\n  output\n}\n\nobtain_diffs(input[[1]])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n [1]      3     10     23     46     99    234    563   1310   2904   6131\n[11]  12351  23745  43470  75464 123501 189097 268370 349700 418439 484617\n[21] 669380\n\n[[2]]\n [1]      7     13     23     53    135    329    747   1594   3227   6220\n[11]  11394  19725  31994  48037  65596  79273  81330  68739  66178 184763\n\n[[3]]\n [1]      6     10     30     82    194    418    847   1633   2993   5174\n[11]   8331  12269  16043  17559  13677   2057 -12591  -2561 118585\n\n[[4]]\n [1]      4     20     52    112    224    429    786   1360   2181   3157\n[11]   3938   3774   1516  -3882 -11620 -14648  10030 121146\n\n[[5]]\n [1]     16     32     60    112    205    357    574    821    976    781\n[11]   -164  -2258  -5398  -7738  -3028  24678 111116\n\n[[6]]\n [1]    16    28    52    93   152   217   247   155  -195  -945 -2094 -3140\n[13] -2340  4710 27706 86438\n\n[[7]]\n [1]    12    24    41    59    65    30   -92  -350  -750 -1149 -1046   800\n[13]  7050 22996 58732\n\n[[8]]\n [1]    12    17    18     6   -35  -122  -258  -400  -399   103  1846  6250\n[13] 15946 35736\n\n[[9]]\n [1]     5     1   -12   -41   -87  -136  -142     1   502  1743  4404  9696\n[13] 19790\n\n[[10]]\n [1]    -4   -13   -29   -46   -49    -6   143   501  1241  2661  5292 10094\n\n[[11]]\n [1]   -9  -16  -17   -3   43  149  358  740 1420 2631 4802\n\n[[12]]\n [1]   -7   -1   14   46  106  209  382  680 1211 2171\n\n[[13]]\n[1]   6  15  32  60 103 173 298 531 960\n\n[[14]]\n[1]   9  17  28  43  70 125 233 429\n\n[[15]]\n[1]   8  11  15  27  55 108 196\n\n[[16]]\n[1]  3  4 12 28 53 88\n\n[[17]]\n[1]  1  8 16 25 35\n\n[[18]]\n[1]  7  8  9 10\n\n[[19]]\n[1] 1 1 1\n\n[[20]]\n[1] 0 0\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nseries_with_diffs <- map(input, obtain_diffs)\nseries_with_diffs[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n [1]      3     10     23     46     99    234    563   1310   2904   6131\n[11]  12351  23745  43470  75464 123501 189097 268370 349700 418439 484617\n[21] 669380\n\n[[2]]\n [1]      7     13     23     53    135    329    747   1594   3227   6220\n[11]  11394  19725  31994  48037  65596  79273  81330  68739  66178 184763\n\n[[3]]\n [1]      6     10     30     82    194    418    847   1633   2993   5174\n[11]   8331  12269  16043  17559  13677   2057 -12591  -2561 118585\n\n[[4]]\n [1]      4     20     52    112    224    429    786   1360   2181   3157\n[11]   3938   3774   1516  -3882 -11620 -14648  10030 121146\n\n[[5]]\n [1]     16     32     60    112    205    357    574    821    976    781\n[11]   -164  -2258  -5398  -7738  -3028  24678 111116\n\n[[6]]\n [1]    16    28    52    93   152   217   247   155  -195  -945 -2094 -3140\n[13] -2340  4710 27706 86438\n\n[[7]]\n [1]    12    24    41    59    65    30   -92  -350  -750 -1149 -1046   800\n[13]  7050 22996 58732\n\n[[8]]\n [1]    12    17    18     6   -35  -122  -258  -400  -399   103  1846  6250\n[13] 15946 35736\n\n[[9]]\n [1]     5     1   -12   -41   -87  -136  -142     1   502  1743  4404  9696\n[13] 19790\n\n[[10]]\n [1]    -4   -13   -29   -46   -49    -6   143   501  1241  2661  5292 10094\n\n[[11]]\n [1]   -9  -16  -17   -3   43  149  358  740 1420 2631 4802\n\n[[12]]\n [1]   -7   -1   14   46  106  209  382  680 1211 2171\n\n[[13]]\n[1]   6  15  32  60 103 173 298 531 960\n\n[[14]]\n[1]   9  17  28  43  70 125 233 429\n\n[[15]]\n[1]   8  11  15  27  55 108 196\n\n[[16]]\n[1]  3  4 12 28 53 88\n\n[[17]]\n[1]  1  8 16 25 35\n\n[[18]]\n[1]  7  8  9 10\n\n[[19]]\n[1] 1 1 1\n\n[[20]]\n[1] 0 0\n```\n\n\n:::\n:::\n\n\nCool, now the next step is to make the predictions/imputations using this data. Again, all the series behave independently, so they're suitable for functional programming (creating functions and then apply them through `purrr::map`).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nexample_case <- series_with_diffs[[1]]\n\ncurrent_element <- example_case[[20]]\n\ncurrent_element[length(current_element)]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0\n```\n\n\n:::\n\n```{.r .cell-code}\n# I have to \"iterate in reverse\" from the last element to the first one\ncurrent_diff <- 0\nfor (i in rev(seq_along(example_case))) {\n  current_seq <- example_case[[i]]\n  last_el_seq <- current_seq[length(current_seq)]\n  current_seq <- c(current_seq, last_el_seq+current_diff)\n  example_case[[i]] <- current_seq\n\n  current_diff <- current_seq[length(current_seq)] # new element in the sequence\n}\n```\n:::\n\n\nThe code above solves for a single, example case. Now I'll wrap it in a function and apply it to each of the sequences in the list:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadd_to_history <- function(history_with_diffs) {\n\n  current_element <- history_with_diffs[[length(history_with_diffs)]]\n\n  # I have to \"iterate in reverse\" from the last element to the first one\n  current_diff <- 0\n  for (i in rev(seq_along(history_with_diffs))) {\n    current_seq <- history_with_diffs[[i]]\n    last_el_seq <- current_seq[length(current_seq)]\n    current_seq <- c(current_seq, last_el_seq+current_diff)\n    history_with_diffs[[i]] <- current_seq\n\n    current_diff <- current_seq[length(current_seq)] # new element in the sequence\n  }\n\n  history_with_diffs\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nseries_with_diffs2 <- map(series_with_diffs, add_to_history)\n```\n:::\n\n\nNow I have to get the last element of the first sequence (`~.[[1]][length(.[[1]])]`) in each element of `series_with_diffs2` and add all them up.\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_dbl(series_with_diffs2, ~.[[1]][length(.[[1]])]) %>%\n  sum()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 2174807968\n```\n\n\n:::\n:::\n\n\nThe solution is correct!\n\n## Part 2\n\nPart 2 is just extrapolating backwards instead of forwards. I'm sure that I can do this by just adjusting some parameters in the functions I've already created.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nadd_to_history_backwards <- function(history_with_diffs) {\n\n  current_element <- history_with_diffs[[length(history_with_diffs)]]\n\n  # I have to \"iterate in reverse\" from the last element to the first one\n  current_diff <- 0\n  for (i in rev(seq_along(history_with_diffs))) {\n    current_seq <- history_with_diffs[[i]]\n    first_el_seq <- current_seq[1]\n    current_seq <- c(first_el_seq-current_diff, current_seq)\n    history_with_diffs[[i]] <- current_seq\n\n    current_diff <- current_seq[1] # new element in the sequence\n  }\n\n  history_with_diffs\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmap(series_with_diffs, add_to_history_backwards) %>%\n  map_dbl(~.[[1]][1]) %>%\n  sum()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 1208\n```\n\n\n:::\n:::\n\n\nIt's correct too!",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}